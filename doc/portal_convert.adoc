= PORTAL 中间件
:author: fangzheng <fangzheng@gbcom.com.cn>
:toc: left
:icons:
:numbered:

== 文档说明
适配云平台portal 2.0功能.

=== 修改记录
[width="40%"]
|====================
| 文档版本|修订时间|修订人|修订内容
| 1.0     | 2015-11-08|方政|
|====================
=== 编写目的
1. 运营商设备支持的标准portal 2.0认证方式，是目前云平台所不支持。考虑到云平台固有的认证方式，修改成本较大，所以，产生此模块来适配云平台。


== 需求分析
=== 业务需求
1. 云营商portal认证需求

== portal认证
=== 流程描述
[plantuml, diagram-classes, png]
....
终端 -> Bas: 开始发起http请求
note left: 连接wifi
Bas --> 终端: 回复http重定向,目的为中间件
终端 -> 中间件: 第二次发起http请求
中间件 --> 终端: 重定向至云平台
note right: 报文url转换为云平台格式
终端 -> 云平台: 第三次发起http请求
|||
云平台 --> 终端: 送出portal页面
终端 -> 云平台: 输入用户名、密码,提交表单
云平台 --> 终端: 重定向报文至中间件
note right: 携带用户名、密码(DES加密),token
终端 -> 中间件: get请求发起portal认证
|||
中间件 --> Bas: portal认证开始
Bas -> 中间件: portal认证结束，认证通过
|||
中间件 -> 云平台: request token check
云平台 --> 中间件: response auth code
|||
中间件 --> 终端: Http重定向至云平台
终端 -> 云平台: 访问云平台
note left: 携带gw_id,token
云平台 --> 终端: 认证通过
....

== 中间件管理
=== 中间件与平台保活流程

